<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <title>ToDo</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.t.css">
</head>
<body>
<div class="container">
    <div class="row justify-contect-center mt-4">
        <div class="col-10 col-md-6">

            <header class="d-flex align-item-center">
                <i class="bi bi-calendar-check fs-3"></i>
                <h3 class="text-secondary ms-2 mb-0">Todo List</h3>

            </header>

            <form id="item-form" class="my-4">
                <div class="mb-3">
                    <label for="item-input" class="form-label">Enter Item</label>
                    <input type="text" class="form-control" id="item-input" />
                    <div id="input-invalid" class="form-text text-danger"></div>
                </div>
                <button type="submit" class="btn btn-sm btn-dark">
                    <i class="bi bi-plus"></i>
                    Add Item
                </button>
            </form>
            <div>
                <input
                id="filter"
                class="form-control form-control-sm"
                type="text"
                placeholder="Filter Item"
                />
            </div>
            <ul id="item-list" class="my-4 p-0">
<!--                <li class="list-item">-->
<!--                    An item-->
<!--                    <i class="bi bi-x fs-5 text-danger"></i>-->
<!--                </li>-->

<!--                <li class="list-item">-->
<!--                    A second item-->
<!--                    <i class="bi bi-x fs-5 text-danger"></i>-->
<!--                </li>-->

<!--                <li class="list-item">-->
<!--                    A third item-->
<!--                    <i class="bi bi-x fs-5 text-danger"></i>-->
<!--                </li>-->

<!--                <li class="list-item">-->
<!--                    A fourth item-->
<!--                    <i class="bi bi-x fs-5 text-danger"></i>-->
<!--                </li>-->

<!--                <li class="list-item">-->
<!--                    A fifth item-->
<!--                    <i class="bi bi-x fs-5 text-danger"></i>-->
<!--                </li>-->

            </ul>
            <div class="d-grid">
                <button id="items-clear" class="btn btn-outline-dark" type="button">
                    Clear All
                </button>
            </div>

        </div>

    </div>

</div>

<script>

const itemForm = document.getElementById('item-form');
const itemInput = document.getElementById('item-input');
const inputInvalid = document.getElementById('input-invalid');
const itemlist  = document.getElementById('item-list');
const clearbtn  = document.getElementById('items-clear');
const itemFilter  = document.getElementById('filter');
const formBtn  = itemForm.querySelector('button');
let isEditMode = false;


function displayItems() {
    let itemFromStorage = getItemsFromStorage();


    itemFromStorage.forEach(item => addToDOM(item));
    checkUI();
}





function addItem(e) {
    e.preventDefault();

    const newItem = itemInput.value;
    if(newItem == ''){
        inputInvalid.innerText = 'please add an item';
        return;
    }else {
        inputInvalid.innerText = '';
    }

    if(isEditMode){
        const itemToEdite = itemlist.querySelector('.edit-mode');
        removeItemStorage(itemToEdite.textContent);
        itemToEdite.remove();
        formBtn.innerHTML = "  <i class=\'bi bi-plus\'></i> Add Item";
        formBtn.classList.replace('btn-primary' , 'btn-dark');

        isEditMode = false;
    }else {
        if(checkIfItemExists(newItem)){
            inputInvalid.innerText = 'That item already exists!'
            return;;
        }else {
            inputInvalid.innerText ='';
        }
    }






    addToDOM(newItem);
    addItemStorage(newItem);

    itemInput.value = '';
    checkUI();

}

function checkIfItemExists(item){
    let itemFromStorage = getItemsFromStorage();
    return itemFromStorage.includes(item);
}

function addToDOM(item){
    const li = document.createElement('li');
    li.className = 'list-item';
    li.textContent = item;
    const icon = createIcon('bi bi-x fs-5 text-danger');
    li.appendChild(icon);

    itemlist.appendChild(li);
}

function addItemStorage(item){

    let itemFromStorage = getItemsFromStorage();



    itemFromStorage.push(item);
    localStorage.setItem('items' ,JSON.stringify(itemFromStorage))
}



function getItemsFromStorage(){
    let itemFromStorage;

    if(localStorage.getItem('items') === null)
    {
        itemFromStorage = [];
    }else {
        itemFromStorage = JSON.parse(localStorage.getItem('items'))
    }
    return itemFromStorage;
}




function createIcon(classes){
    const icon = document.createElement('i');
    icon.className = classes;
    return icon;
}
function onClickItem(e){
    if (e.target.classList.contains('bi-x')){
        removeItems(e.target.parentElement)
        removeItemStorage(e.target.parentElement.textContent);
        checkUI();
    } else {
        setItemToEdite(e.target);
    }
}




function clearItems(){
    itemlist.innerHTML = '';
    localStorage.removeItem('items');
    checkUI();
}

function removeItems(item){

        item.remove();
        removeItemStorage(item.textContent);
        checkUI();
}


function removeItemStorage(item){
    let itemsFromSrorage = getItemsFromStorage();
    itemsFromSrorage = itemsFromSrorage.filter((i) => i!= item);
    localStorage.setItem('items' , JSON.stringify(itemsFromSrorage))
}

function setItemToEdite(item){
    isEditMode = true;

    itemlist.querySelectorAll('li').forEach(item => item.classList.remove('edit-mode'))
    item.classList.add('edit-mode');

    itemInput.value = item.textContent

    formBtn.innerHTML = "  <i class=\"bi bi-pencil-fill\"></i>Update Item";
    formBtn.classList.replace('btn-dark' , 'btn-primary')
}

function checkUI(){
    const items = itemlist.querySelectorAll('li');
    if (items.length === 0) {

        clearbtn.style.display = 'none';
        itemFilter.style.display = 'none';
    } else {
        clearbtn.style.display = 'block';
        itemFilter.style.display = 'block';
    }
}
function filterItems(e) {
    const items = itemlist.querySelectorAll('li');
    const text = e.target.value.toLowerCase();

    items.forEach((item) => {
        const itemName = item.firstChild.textContent.toLowerCase();
        if (itemName.indexOf(text) !== -1){
            item.style.display = 'flex';
        } else {
            item.style.display = 'none';
        }

    })

}

itemForm.addEventListener('submit' ,addItem);
itemlist.addEventListener('click' ,onClickItem);
clearbtn.addEventListener('click' ,clearItems);
itemFilter.addEventListener('input' ,filterItems);
document.addEventListener('DOMContentLoaded' ,displayItems);

checkUI();





</script>
</body>
</html>